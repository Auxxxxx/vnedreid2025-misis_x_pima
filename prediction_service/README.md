# Prediction Service

Spring Boot —Å–µ—Ä–≤–∏—Å –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π Docker –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–±–æ—Ä–∫–æ–π.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone <your-repo-url>
cd prediction_service

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–±–æ—Ä–∫—É –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
./build.sh
```

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω:
- üåê **API:** http://localhost:8080/prediction/swagger-ui.html
- üìã **OpenAPI JSON:** http://localhost:8080/prediction/v3/api-docs
- üîç **Ping:** http://localhost:8080/prediction/api/ping
- üìä **Health:** http://localhost:8080/prediction/actuator/health

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
prediction_service/
‚îú‚îÄ‚îÄ src/main/java/com/example/predictionservice/
‚îÇ   ‚îú‚îÄ‚îÄ PredictionServiceApplication.java     # –ì–ª–∞–≤–Ω—ã–π –∫–ª–∞—Å—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ web/                                  # REST –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ service/                              # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ model/                                # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ exceptions/                           # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ config/                               # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ src/main/resources/
‚îÇ   ‚îî‚îÄ‚îÄ application.yml                       # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Spring Boot
‚îú‚îÄ‚îÄ docker-compose.yml                        # Docker Compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ Dockerfile                                # Docker –æ–±—Ä–∞–∑
‚îú‚îÄ‚îÄ .env.example                              # –ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å—Ä–µ–¥—ã
‚îú‚îÄ‚îÄ build.sh                                  # –°–∫—Ä–∏–ø—Ç —Å–±–æ—Ä–∫–∏ –∏ –∑–∞–ø—É—Å–∫–∞
‚îú‚îÄ‚îÄ push.sh                                   # –°–∫—Ä–∏–ø—Ç –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤ DockerHub
‚îî‚îÄ‚îÄ stop.sh                                   # –°–∫—Ä–∏–ø—Ç –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
```

## –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç —Å Docker Compose (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± –∑–∞–ø—É—Å–∫–∞:

```bash
./build.sh
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –°–æ–±–∏—Ä–∞–µ—Ç JAR —Ñ–∞–π–ª
- –°–æ–∑–¥–∞–µ—Ç Docker –æ–±—Ä–∞–∑
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å—Ä–µ–¥—ã
- –ó–∞–ø—É—Å–∫–∞–µ—Ç —Å–µ—Ä–≤–∏—Å —á–µ—Ä–µ–∑ Docker Compose

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–º

**–û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–∞:**
```bash
./stop.sh
```

**–û—Ç–ø—Ä–∞–≤–∫–∞ –æ–±—Ä–∞–∑–∞ –≤ DockerHub:**
```bash
./push.sh
```

### –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

#### –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Java 8 –∏ Maven

2. –°–æ–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –±–µ–∑ —Ç–µ—Å—Ç–æ–≤):
   ```bash
   mvn clean package
   ```

3. –ò–ª–∏ —Å–æ–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç —Å –∑–∞–ø—É—Å–∫–æ–º —Ç–µ—Å—Ç–æ–≤:
   ```bash
   mvn clean package -Pwith-tests
   ```

4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
   ```bash
   java -jar target/prediction-service-1.0.0.jar
   ```

#### Docker Compose –∑–∞–ø—É—Å–∫

1. –°–æ–±–µ—Ä–∏—Ç–µ JAR —Ñ–∞–π–ª –¥–ª—è Docker (–±–µ–∑ —Ç–µ—Å—Ç–æ–≤):
   ```bash
   mvn clean package -Pdocker-build
   ```

2. –°–æ–±–µ—Ä–∏—Ç–µ Docker –æ–±—Ä–∞–∑:
   ```bash
   docker build -t auxxxxx/vnedreid2025-prediction_service:latest .
   ```

3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —á–µ—Ä–µ–∑ Docker Compose:
   ```bash
   docker compose up -d
   ```

### –í–∞—Ä–∏–∞–Ω—Ç—ã —Å–±–æ—Ä–∫–∏

- **–°–±–æ—Ä–∫–∞ –±–µ–∑ —Ç–µ—Å—Ç–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é):**
  ```bash
  mvn clean package
  ```

- **–°–±–æ—Ä–∫–∞ —Å —Ç–µ—Å—Ç–∞–º–∏:**
  ```bash
  mvn clean package -Pwith-tests
  ```
  –∏–ª–∏
  ```bash
  mvn clean package -Dmaven.test.skip=false
  ```

- **–¢–æ–ª—å–∫–æ –∫–æ–º–ø–∏–ª—è—Ü–∏—è –±–µ–∑ —É–ø–∞–∫–æ–≤–∫–∏:**
  ```bash
  mvn clean compile
  ```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–±–æ—Ä–∫–∞

–î–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è —Å–±–æ—Ä–∫–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã:

**–û—Å–Ω–æ–≤–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã:**
- `./build.sh` - –ü–æ–ª–Ω–∞—è —Å–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker Compose
- `./push.sh` - –û—Ç–ø—Ä–∞–≤–∫–∞ –æ–±—Ä–∞–∑–∞ –≤ DockerHub
- `./stop.sh` - –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

**Windows:**
```cmd
build.bat
```

–°–∫—Ä–∏–ø—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –ü—Ä–æ–≤–µ—Ä—è—é—Ç –Ω–∞–ª–∏—á–∏–µ Java –∏ Maven
- –°–æ–±–∏—Ä–∞—é—Ç –ø—Ä–æ–µ–∫—Ç –±–µ–∑ —Ç–µ—Å—Ç–æ–≤
- –í—ã–≤–æ–¥—è—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ —Å–±–æ—Ä–∫–∏

## API Endpoints

### Ping Endpoint
- **GET** `/api/ping` - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–∞

–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:
```json
{
  "message": "pong",
  "timestamp": 1640995200000,
  "status": "UP"
}
```

### Prediction Endpoint
- **POST** `/api/submit-photo` - –ê–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–π

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:**
- `file` (multipart/form-data) - –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ PNG –∏–ª–∏ JPEG (–º–∞–∫—Å–∏–º—É–º 10MB)

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:**
```json
{
  "category": 3,
  "dent": true,
  "rust": false,
  "scratch": true,
  "deformation": false,
  "res_photo": "iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChAFIdni/6wAAAABJRU5ErkJggg==",
  "res_gif": "R0lGODdhAQABAIAAAP///wAAACwAAAAAAQABAAACAkQBADs=",
  "percentage": 87
}
```

**–ü–æ–ª—è –æ—Ç–≤–µ—Ç–∞:**
- `category` - –ö–∞—Ç–µ–≥–æ—Ä–∏—è –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—è (1-5)
- `dent` - –ù–∞–ª–∏—á–∏–µ –≤–º—è—Ç–∏–Ω—ã (boolean)
- `rust` - –ù–∞–ª–∏—á–∏–µ —Ä–∂–∞–≤—á–∏–Ω—ã (boolean)
- `scratch` - –ù–∞–ª–∏—á–∏–µ —Ü–∞—Ä–∞–ø–∏–Ω—ã (boolean)
- `deformation` - –ù–∞–ª–∏—á–∏–µ –¥–µ—Ñ–æ—Ä–º–∞—Ü–∏–∏ (boolean)
- `res_photo` - –û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ base64
- `res_gif` - –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π GIF —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ base64
- `percentage` - –ü—Ä–æ—Ü–µ–Ω—Ç —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ (0-100)

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å curl:**
```bash
curl -X POST http://localhost:8080/prediction/api/submit-photo \
  -F "file=@/path/to/image.jpg" \
  -H "Content-Type: multipart/form-data"
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ML API

–°–µ—Ä–≤–∏—Å –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å ML API –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å—Ä–µ–¥—ã:

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|------------|----------|----------------------|
| `ML_API_HOST` | –•–æ—Å—Ç ML API —Å–µ—Ä–≤–∏—Å–∞ | `localhost` |
| `ML_API_PORT` | –ü–æ—Ä—Ç ML API —Å–µ—Ä–≤–∏—Å–∞ | `8000` |
| `ML_API_ENDPOINT` | Endpoint ML API | `/predict` |
| `ML_API_TIMEOUT` | –¢–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ (–º—Å) | `30000` |

**–ü—Ä–∏–º–µ—Ä ML API –æ—Ç–≤–µ—Ç–∞:**
```json
{
  "car_bbox": [100, 150, 200, 250],
  "damage_ratio": 0.15,
  "detections": {
    "rust": [
      {
        "bbox": {
          "x_min": 100,
          "y_min": 150,
          "x_max": 120,
          "y_max": 170,
          "width": 20,
          "height": 20
        },
        "confidence": 0.95
      }
    ],
    "dent": [],
    "scratch": []
  }
}
```

### –ó–∞–ø—É—Å–∫ ML API

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ ML API –∑–∞–ø—É—â–µ–Ω –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω–æ–º —Ö–æ—Å—Ç–µ –∏ –ø–æ—Ä—Ç—É –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–µ—Ä–≤–∏—Å–∞ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π.

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—É—Å–∫–∞ ML API (–µ—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Å–µ—Ä–≤–∏—Å):**
```bash
# –ó–∞–ø—É—Å–∫ ML API –Ω–∞ localhost:8000
python ml_api_server.py --host localhost --port 8000
```

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Swagger UI:
- Swagger UI: http://localhost:8080/prediction/swagger-ui.html
- OpenAPI JSON: http://localhost:8080/prediction/v3/api-docs

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–µ—Ä–≤–∏—Å –∑–∞–ø—É—â–µ–Ω:
```bash
curl http://localhost:8080/prediction/api/ping
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ health endpoint:
```bash
curl http://localhost:8080/prediction/actuator/health
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤:
```bash
mvn test
```